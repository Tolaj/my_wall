<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendar Widget</title>
    <script src="https://cdn.tailwindcss.com"></script>

</head>

<body>
    <div id="calendarDialog" class="w-fit bg-transparent">
        <div class="p-8 bg-white rounded-t">
            <div class="px-4 flex items-center justify-between">
                <span class="text-base font-bold text-gray-800" id="monthYear">October 2025</span>
                <div class="flex items-center">
                    <button id="prevBtn" aria-label="calendar backward" class="hover:text-gray-400 text-gray-800">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left"
                            width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
                            fill="none" stroke-linecap="round" stroke-linejoin="round">
                            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                            <polyline points="15 6 9 12 15 18" />
                        </svg>
                    </button>
                    <button id="nextBtn" aria-label="calendar forward" class="hover:text-gray-400 ml-3 text-gray-800">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-right"
                            width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
                            fill="none" stroke-linecap="round" stroke-linejoin="round">
                            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                            <polyline points="9 6 15 12 9 18" />
                        </svg>
                    </button>
                </div>
            </div>
            <div class="flex items-center justify-between pt-12 overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr>
                            <th>
                                <div class="w-full flex justify-center">
                                    <p class="text-base font-medium text-center text-gray-800">Mo</p>
                                </div>
                            </th>
                            <th>
                                <div class="w-full flex justify-center">
                                    <p class="text-base font-medium text-center text-gray-800">Tu</p>
                                </div>
                            </th>
                            <th>
                                <div class="w-full flex justify-center">
                                    <p class="text-base font-medium text-center text-gray-800">We</p>
                                </div>
                            </th>
                            <th>
                                <div class="w-full flex justify-center">
                                    <p class="text-base font-medium text-center text-gray-800">Th</p>
                                </div>
                            </th>
                            <th>
                                <div class="w-full flex justify-center">
                                    <p class="text-base font-medium text-center text-gray-800">Fr</p>
                                </div>
                            </th>
                            <th>
                                <div class="w-full flex justify-center">
                                    <p class="text-base font-medium text-center text-gray-800">Sa</p>
                                </div>
                            </th>
                            <th>
                                <div class="w-full flex justify-center">
                                    <p class="text-base font-medium text-center text-gray-800">Su</p>
                                </div>
                            </th>
                        </tr>
                    </thead>
                    <tbody id="calendarBody">
                        <!-- Days will be inserted here -->
                    </tbody>
                </table>
            </div>
        </div>
        <div class="py-8 px-16 bg-gray-50 rounded-b" id="eventsSection">
            <div class="px-4">
                <p class="text-center text-gray-400">Select a date to view events</p>
            </div>
        </div>
    </div>
    <script>

        const { ipcRenderer } = require("electron");

        const monthNames = ["January", "February", "March", "April", "May", "June",
            "July", "August", "September", "October", "November", "December"];

        let currentDate = new Date();
        let currentMonth = currentDate.getMonth();
        let currentYear = currentDate.getFullYear();
        let selectedDate = null;

        // Sample events data
        const events = {
            '2025-10-6': [
                { time: '9:00 AM', title: 'Zoom call with design team', description: 'Discussion on UX sprint and Wireframe review' },
                { time: '10:00 AM', title: 'Orientation session with new hires', description: '' },
                { time: '2:00 PM', title: 'Client presentation', description: 'Q4 strategy review' }
            ],
            '2025-10-8': [
                { time: '11:00 AM', title: 'Team standup', description: 'Daily sync with development team' }
            ],
            '2025-10-15': [
                { time: '3:00 PM', title: 'Product demo', description: 'Showcase new features to beta users' }
            ]
        };

        function renderCalendar() {
            const calendarBody = document.getElementById('calendarBody');
            calendarBody.innerHTML = '';

            document.getElementById('monthYear').textContent = `${monthNames[currentMonth]} ${currentYear}`;

            const today = new Date();
            const isCurrentMonth = currentYear === today.getFullYear() && currentMonth === today.getMonth();
            const todayDate = today.getDate();

            const firstDay = new Date(currentYear, currentMonth, 1);
            let startingDayOfWeek = firstDay.getDay() - 1;
            if (startingDayOfWeek < 0) startingDayOfWeek = 6;

            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const daysInMonth = lastDay.getDate();

            let dayCount = 1;
            let rows = Math.ceil((daysInMonth + startingDayOfWeek) / 7);

            for (let week = 0; week < rows; week++) {
                const row = document.createElement('tr');

                for (let day = 0; day < 7; day++) {
                    const cell = document.createElement('td');
                    cell.className = week === 0 ? 'pt-6' : '';

                    const cellIndex = week * 7 + day;

                    if (cellIndex < startingDayOfWeek || dayCount > daysInMonth) {
                        cell.innerHTML = '<div class="px-2 py-2 cursor-pointer flex w-full justify-center"></div>';
                    } else {
                        const dateKey = `${currentYear}-${currentMonth + 1}-${dayCount}`;
                        const isSelected = selectedDate === dateKey;
                        const isToday = isCurrentMonth && dayCount === todayDate;

                        if (isSelected) {
                            cell.innerHTML = `
                                <div class="w-full h-full">
                                    <div class="flex items-center justify-center w-full rounded-full cursor-pointer">
                                        <a class="focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-700 focus:bg-indigo-500 hover:bg-indigo-500 text-base w-8 h-8 flex items-center justify-center font-medium text-white bg-indigo-700 rounded-full" data-date="${dateKey}">${dayCount}</a>
                                    </div>
                                </div>`;
                        } else {
                            cell.innerHTML = `
                                <div class="px-2 py-2 cursor-pointer flex w-full justify-center">
                                    <p class="text-base text-gray-500 font-medium hover:text-indigo-700" data-date="${dateKey}">${dayCount}</p>
                                </div>`;
                        }
                        dayCount++;
                    }

                    row.appendChild(cell);
                }

                calendarBody.appendChild(row);
            }

            addDateClickListeners();
        }

        function addDateClickListeners() {
            document.querySelectorAll('[data-date]').forEach(elem => {
                elem.addEventListener('click', function () {
                    selectedDate = this.getAttribute('data-date');
                    renderCalendar();
                    displayEvents(selectedDate);
                });
            });
        }

        function displayEvents(dateKey) {
            const eventsSection = document.getElementById('eventsSection');
            const dayEvents = events[dateKey] || [];

            if (dayEvents.length === 0) {
                eventsSection.innerHTML = `
                    <div class="px-4">
                        <p class="text-center text-gray-400">No events for this date</p>
                    </div>`;
            } else {
                let eventsHTML = '<div class="px-4">';
                dayEvents.forEach((event, index) => {
                    const borderClass = index < dayEvents.length - 1 ? 'border-b pb-4 border-gray-400 border-dashed' : '';
                    const marginClass = index > 0 ? 'pt-5' : '';

                    eventsHTML += `
                        <div class="${borderClass} ${marginClass}">
                            <p class="text-xs font-light leading-3 text-gray-500">${event.time}</p>
                            <a class="focus:outline-none text-lg font-medium leading-5 text-gray-800 mt-2 block">${event.title}</a>
                            ${event.description ? `<p class="text-sm pt-2 leading-4 text-gray-600">${event.description}</p>` : ''}
                        </div>`;
                });
                eventsHTML += '</div>';
                eventsSection.innerHTML = eventsHTML;
            }
        }

        document.getElementById('prevBtn').addEventListener('click', () => {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            renderCalendar();
        });

        document.getElementById('nextBtn').addEventListener('click', () => {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            renderCalendar();
        });

        renderCalendar();

        function sendCurrentSize() {
            const rect = document.getElementById('calendarDialog').getBoundingClientRect();
            ipcRenderer.send('resize-calendar', {
                width: Math.ceil(rect.width),
                height: Math.ceil(rect.height)
            });
        }
        sendCurrentSize()
    </script>
</body>

</html>